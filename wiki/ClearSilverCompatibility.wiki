= !ClearSilver Compatibility =

For most cases, JSilver (JS) and ClearSilver (CS) templates should be compatible - the same template files should behave the same in _most_ situations.

== Template Syntax ==

=== The : vs ! command syntax. ===

Commands like this `<?cs var:x ?>`, can also be written like this `<?cs var!x ?>`. The difference being that ! will fail fast if the variable is missing, whereas : will silently skip the line. CS supports this, JS currently does not.

=== Macro scoping ===

In CS, when a file is included through *include* it shares the same set of macros, however with *linclude* it uses an entirely different interpreter context, with a different set of macros. JS uses the same interpreter context for include and linclude.

=== The inline directive. ===

JS supports a new inline directive with '<?cs inline ?>' and '<?cs /inline ?>. This wraps a section of a template and suppresses outputting any literal whitespace. This is useful when writing complex macros that are to emit a simple inline result. When using this directive the literal template text within the inline section may only contain whitespace.

Instead of:
{{{
<?cs def:func() ?>Result: <?cs if:x ?><?cs var:foo ?><?cs else ?><?cs:var:bar ?><?cs /if ?><?cs /def ?>
}}}

You can now write:
{{{
<?cs def:func() ?><?cs inline ?>
  <?cs var:"Result: " ?>
  <?cs if:x ?>
    <?cs var:foo ?>
  <?cs else ?>
    <?cs var:bar ?>
  <?cs /if ?>
<?cs /inline ?><?cs /def ?>
}}}
(Note how the 'Result: ' string must now be emitted by a var command rather than just being in the template.)

This makes it much easier to write complex macros that are structured like normal programming languages.

== API ==
The core JSilver Java API has been completely redesigned - it looks very different to the CS wrappers. You should find it a lot simpler and easier to extend. However, to facilitate migration to JSilver, we have implemented HDF and CS adaptors that allow JSilver to be enabled by adding a single line of code.

=== !ClearsilverFactory and !FactoryLoader ===

All HDF and CS objects are created via a `org.clearsilver.ClearsilverFactory` object.  By default, most code relies on the global singleton `ClearsilverFactory` object stored in `org.clearsilver.FactoryLoader`.  It is accessed by calling `FactoryLoader.getClearsilverFactory`.  The default singleton is a `JniClearsilverFactory` which uses the old common JNI implementation.  This singleton can be replaced via a call to `FactoryLoader.setClearsilverFactory(ClearsilverFactory)` or by setting the system property `"org.clearsilver.defaultClearsilverFactory"`.

To allow simple migration to JSilver we provide a `ClearsilverFactory` implementation that constructs JSilver-backed HDF and CS objects.  To use it simply construct the factory and hand it to `FactoryLoader`.
{{{
FactoryLoader.setClearsilverFactory(
    new com.google.clearsilver.jsilver.adaptor.JSilverFactory())
}}}

The `JSilverFactory` constructor can take in a `JSilverOptions` object, letting you specify all the configuration parameters for JSilver, just as the JSilver object does. In fact, if you are already using a JSilver object in your application, you can pass that into the constructor instead. The `JSilverFactory` will then use that JSilver object as the underlying implmentation instead of constructing a new one.

While the HDF and CS objects constucted by `JSilverFactory` support `CSFileLoaders` for compatibility, developers will likely want to rely on JSilver's CS template caching instead of implementing their own.  A `CSFileLoader` that caches HDF files may still be useful, though.

== Configuration ==

=== hdf.loadpath ===

CS determines the paths to load templates from the hdf.loadpath structure in the HDF.

JS determines the paths based on a `ResourceLoader` passed in to the JSilver constructor in code. This is by design.

If you do any cleverness with hdf.loadpath, you will have to convert this to `ResourceLoader` code.

=== `Config.WhiteSpaceStrip` ===

A single HTML  whitespace stripping mode in JSilver.  It is similar, but not exactly the same as, `Config.WhiteSpaceStrip = 2` in JNI !ClearSilver.  It can be enabled by either setting the HDF variable `Config.WhiteSpaceStrip` to be any postive value or via `JSilverOptions.setStripHtmlWhiteSpace(true)`.  Please test your code after enabling to ensure that there are no unexpected inconsistencies when going from the JNI whitespace stripper to the JSilver one.

=== `ClearSilver.DisplayDebug` ===

Not currently supported in JS.

=== `Config.TagStart` ===

Not supported in JS.

Annoyingly, this is really tricky to do in JS because the parser is generated by a compiler.